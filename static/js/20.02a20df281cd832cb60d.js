webpackJsonp([20],{"7LK6":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("Gu7T"),i=n.n(a),r=n("Xxa5"),s=n.n(r),o=n("exGp"),c=n.n(o),d=n("bOdI"),l=n.n(d),u=(n("k3b4"),n("+2ln")),p=(n("nsZj"),n("T2s0"),n("1H7Z"),n("WpgC"),n("3IMD"),n("skW6"),n("AA6R")),f=n.n(p),b=n("o69Z"),v=n("rhik"),m=n("SSsa"),h=Object(b.b)("submit-bar"),_=h[0],g=h[1],x=h[2];function y(t,e,n,a){var i=e.tip,r=e.price,s=e.tipIcon;return t("div",f()([{class:g({"safe-area-inset-bottom":e.safeAreaInsetBottom})},Object(v.b)(a)]),[n.top&&n.top(),function(){if(n.tip||i)return t("div",{class:g("tip")},[s&&t(u.a,{class:g("tip-icon"),attrs:{name:s}}),i&&t("span",{class:g("tip-text")},[i]),n.tip&&n.tip()])}(),t("div",{class:g("bar")},[n.default&&n.default(),function(){if("number"==typeof r){var n=(r/100).toFixed(e.decimalLength).split("."),a=e.decimalLength?"."+n[1]:"";return t("div",{style:{textAlign:e.textAlign?e.textAlign:""},class:g("text")},[t("span",[e.label||x("label")]),t("span",{class:g("price")},[e.currency,t("span",{class:g("price","integer")},[n[0]]),a]),e.suffixLabel&&t("span",{class:g("suffix-label")},[e.suffixLabel])])}}(),t(m.a,{attrs:{round:!0,type:e.buttonType,loading:e.loading,disabled:e.disabled,text:e.loading?"":e.buttonText},class:g("button",e.buttonType),on:{click:function(){Object(v.a)(a,"submit")}}})])])}y.props={tip:String,label:String,price:Number,tipIcon:String,loading:Boolean,disabled:Boolean,buttonText:String,suffixLabel:String,safeAreaInsetBottom:Boolean,decimalLength:{type:Number,default:2},currency:{type:String,default:"¥"},buttonType:{type:String,default:"danger"},textAlign:String};var O,C=_(y),k=(n("OWWB"),n("1fWZ")),I=(n("9++/"),n("QhyB")),S=(n("4yKu"),n("wolx")),T=(n("n90r"),n("dJne")),w=(n("iQ6B"),n("H6W6")),j=n("woOf"),L=n.n(j),A=n("vLgD"),B=n("Dod7"),H=n("mw3O"),P=n.n(H),W=function(t){return Object(A.a)({method:"post",url:B.a,data:P.a.stringify(L()(Object(B.c)(),t))})},D=n("VKKs"),E={name:"",data:function(){return{headerStatus:1,brandTitle:"品牌",brandId:"",lineTitle:"产品线",lineId:"",typeTitle:"产品类型",typeId:"",products:[],brandOption:[],lineOption:[],typeOption:[{text:"成品",value:"1"},{text:"赠品",value:"2"}],productList:[],search:"",page:1,pagesize:10,loading:!1,finished:!1}},components:(O={},l()(O,w.a.name,w.a),l()(O,T.a.name,T.a),l()(O,S.a.name,S.a),l()(O,I.a.name,I.a),l()(O,k.a.name,k.a),l()(O,C.name,C),l()(O,u.a.name,u.a),O),watch:{brandId:function(t,e){var n=this;this.brandOption.some(function(e){if(e.value==t)return n.brandTitle=e.text,n.lineOption=e.children,n.page,!0})},lineId:function(t,e){this.page},typeId:function(t,e){var n=this;this.typeOption.some(function(e){if(e.value==t)return n.typeTitle=e.text,n.page,!0})}},created:function(){this._getProductTree()},computed:{total:function(){return this.productList.reduce(function(t,e){return Number(t)+Number(e.number)},0)}},methods:{handleToggleSearch:function(t){this.headerStatus=t},onSearch:function(){this.page=1,this._getProducts()},onSubmit:function(){var t=this.productList.filter(function(t){return t.number>0}),e=Object(D.a)("formData");t.forEach(function(t){var n=!1;e.products.forEach(function(e){t.product_id==e.product_id&&(e.number+=t.number,n=!0)}),n||e.products.push(t)}),Object(D.c)("formData",e),this.$router.back(-1)},_getProductTree:function(){var t=this;return c()(s.a.mark(function e(){var n,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Object(B.b)(),e.next=4,i={flag:"products_tree"},Object(A.a)({method:"post",url:B.a,data:P.a.stringify(L()(Object(B.c)(),i))});case 4:n=e.sent,"SUCC"===(a=n.data).recode&&(t.brandOption=a.data,t.brandId=a.data[0].value,t.lineOption=a.data[0].children),t._getProducts(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}var i},e,t,[[0,10]])}))()},_getProducts:function(){var t=this;return c()(s.a.mark(function e(){var n,a,r,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Object(B.b)(),n=l()({flag:"products",search:t.search,brand_id:t.brandId,line_id:t.lineId,type_id:t.typeId,page:t.page,pagesize:t.pagesize},"search",t.search),e.next=5,W(n);case 5:a=e.sent,"SUCC"===(r=a.data).recode&&(t.loading=!1,r.data.forEach(function(t){t.number=0}),(o=t.productList).push.apply(o,i()(r.data)),r.data.length||(t.finished=!0)),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}},e,t,[[0,10]])}))()},minusHandle:function(t){var e=this.productList.find(function(e){return e.product_id==t});0==e.number?e.number=0:e.number--},addHandle:function(t){this.productList.find(function(e){return e.product_id==t}).number++}}},N={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"header"},[1==t.headerStatus?n("div",{staticClass:"header-tab border-bottom"},[n("div",{staticClass:"jy-dropdown"},[n("van-dropdown-menu",[n("van-dropdown-item",{attrs:{options:t.brandOption,title:t.brandTitle},model:{value:t.brandId,callback:function(e){t.brandId=e},expression:"brandId"}}),t._v(" "),n("van-dropdown-item",{attrs:{options:t.lineOption,title:t.lineTitle},model:{value:t.lineId,callback:function(e){t.lineId=e},expression:"lineId"}}),t._v(" "),n("van-dropdown-item",{attrs:{options:t.typeOption,title:t.typeTitle},model:{value:t.typeId,callback:function(e){t.typeId=e},expression:"typeId"}})],1)],1),t._v(" "),n("div",{staticClass:"search-btn border-left",on:{click:function(e){return t.handleToggleSearch(2)}}},[t._m(0)])]):t._e(),t._v(" "),2==t.headerStatus?n("div",{staticClass:"head-scan-code"},[n("i",{staticClass:"iconfont icon-scan-code"}),t._v(" "),n("form",{attrs:{action:"invalid"}},[n("van-search",{attrs:{placeholder:"输入条形码、品牌、产品线、型号","show-action":""},on:{search:t.onSearch,cancel:function(e){return t.handleToggleSearch(1)}},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1)]):t._e(),t._v(" "),n("div",{staticClass:"prodoct-list"},[n("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了","immediate-check":!1},on:{load:t._getProducts},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.productList,function(e){return n("van-cell",{key:e.product_it},[n("template",{slot:"title"},[n("div",{staticClass:"prodoct-content"},[n("div",{staticClass:"left"},[n("p",[n("span",{staticClass:"brand"},[t._v("【"+t._s(e.product_id)+"】"+t._s(e.line))]),t._v(" "),n("span",{staticClass:"model"},[t._v(t._s(e.model))])]),t._v(" "),n("p",[t._v("条形码："+t._s(e.bar_code))]),t._v(" "),n("p",{staticClass:"stock"},[n("span",[t._v("大库库存："+t._s(e.big_stock))]),t._v(" "),n("span",[t._v("门店库存："+t._s(e.store_stock))])])]),t._v(" "),n("div",{staticClass:"right"},[n("span",{on:{click:function(n){return t.minusHandle(e.product_id)}}},[n("i",{staticClass:"iconfont icon-minus"})]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model.number",value:e.number,expression:"item.number",modifiers:{number:!0}}],attrs:{type:"number",placeholder:"0",pattern:"[0-9]*"},domProps:{value:e.number},on:{input:function(n){n.target.composing||t.$set(e,"number",t._n(n.target.value))},blur:function(e){return t.$forceUpdate()}}}),t._v(" "),n("span",{on:{click:function(n){return t.addHandle(e.product_id)}}},[n("i",{staticClass:"iconfont icon-plus"})])])])])],2)}),1)],1),t._v(" "),n("footer",{staticClass:"footer"},[n("van-submit-bar",{staticClass:"jy-footer border-top",attrs:{"button-text":"确定"},on:{submit:t.onSubmit}},[n("div",{staticClass:"left"},[n("van-icon",{staticClass:"active",attrs:{name:"checked"}}),t._v(" "),n("span",[t._v("已选:")]),t._v(" "),n("span",{staticClass:"number"},[t._v(t._s(t.total))]),t._v(" "),n("span",{staticClass:"text"},[t._v("个")])],1)])],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("span",{},[e("i",{staticClass:"iconfont icon-search"})])}]};var $=n("VU/8")(E,N,!1,function(t){n("8OH5")},"data-v-51b8d705",null);e.default=$.exports},"8OH5":function(t,e){},skW6:function(t,e){}});